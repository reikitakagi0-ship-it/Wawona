name: Protocol Status

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  protocol-status:
    name: Check Protocol Implementations
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Check protocols
        id: protocols
        run: |
          echo "## Protocol Implementation Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Protocol | Status | File |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|--------|------|" >> $GITHUB_STEP_SUMMARY
          
          PROTOCOLS=(
            "wl_compositor:wayland_compositor.c"
            "wl_output:wayland_output.c"
            "wl_seat:wayland_seat.c"
            "wl_shm:wayland_shm.c"
            "wl_subcompositor:wayland_subcompositor.c"
            "wl_data_device_manager:wayland_data_device_manager.c"
            "xdg_wm_base:xdg_shell.c"
            "zwp_linux_dmabuf_v1:wayland_linux_dmabuf.c"
            "zwp_screencopy_manager_v1:wayland_screencopy.c"
            "wp_viewporter:wayland_viewporter.c"
            "zwp_primary_selection_device_manager_v1:wayland_primary_selection.c"
            "zwp_idle_inhibit_manager_v1:wayland_idle_inhibit.c"
            "gtk_shell1:wayland_gtk_shell.c"
            "org_kde_plasma_shell:wayland_plasma_shell.c"
            "qt_surface_extension:wayland_qt_extensions.c"
            "qt_windowmanager:wayland_qt_extensions.c"
            "wp_color_manager_v1:wayland_color_management.c"
          )
          
          for entry in "${PROTOCOLS[@]}"; do
            IFS=':' read -r proto file <<< "$entry"
            if [ -f "src/$file" ]; then
              if grep -q "wl_global_create" "src/$file" 2>/dev/null; then
                echo "| $proto | ✅ Implemented | src/$file |" >> $GITHUB_STEP_SUMMARY
              else
                echo "| $proto | ⚠️ File exists but no global | src/$file |" >> $GITHUB_STEP_SUMMARY
              fi
            else
              echo "| $proto | ❌ Missing | - |" >> $GITHUB_STEP_SUMMARY
            fi
          done

