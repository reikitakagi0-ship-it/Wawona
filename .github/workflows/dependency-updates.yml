name: Test Dependency Updates

on:
  schedule:
    # Test dependency updates weekly
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  test-updates:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Test dependency update script
        run: |
          ./scripts/update-dependencies.sh || {
            echo "Dependency update failed"
            exit 1
          }
      
      - name: Test builds after update
        run: |
          make ios-wayland || exit 1
          make ios-kosmickrisp || exit 1
      
      - name: Verify patches applied
        run: |
          # Check that patches are still valid
          for dep in wayland kosmickrisp pixman; do
            if [ -d "patches/$dep" ]; then
              echo "Checking patches for $dep..."
              ls patches/$dep/*.patch || echo "No patches for $dep"
            fi
          done
